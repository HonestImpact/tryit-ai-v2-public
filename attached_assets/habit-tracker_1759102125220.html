<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker - Visual Calendar & Streak Counter</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; padding: 20px; }
        .tracker-container { background: #f8f9fa; padding: 20px; border-radius: 8px; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .control-section { background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd; }
        .control-section h3 { margin: 0 0 15px 0; color: #333; }
        .habit-input { display: flex; gap: 10px; margin: 10px 0; }
        .habit-input input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .habit-input select { padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .habit-input button { padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .habit-input button:hover { background: #218838; }
        .habits-list { margin: 20px 0; }
        .habit-card { background: white; border: 1px solid #ddd; border-radius: 8px; margin: 10px 0; overflow: hidden; }
        .habit-header { padding: 15px; background: #f8f9fa; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .habit-header:hover { background: #e9ecef; }
        .habit-title { font-weight: bold; display: flex; align-items: center; gap: 10px; }
        .habit-streak { background: #28a745; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9em; }
        .habit-streak.broken { background: #dc3545; }
        .habit-content { padding: 20px; display: none; }
        .habit-content.expanded { display: block; }
        .habit-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; margin: 15px 0; }
        .stat-box { text-align: center; padding: 10px; background: #f8f9fa; border-radius: 6px; }
        .stat-value { font-size: 1.5em; font-weight: bold; color: #007bff; }
        .stat-label { font-size: 0.8em; color: #666; }
        .calendar-view { margin: 20px 0; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; }
        .calendar-nav { background: #007bff; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; }
        .calendar-nav:hover { background: #0056b3; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin: 10px 0; }
        .calendar-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border: 1px solid #ddd; background: white; cursor: pointer; position: relative; }
        .calendar-day:hover { background: #f8f9fa; }
        .calendar-day.today { border: 2px solid #007bff; font-weight: bold; }
        .calendar-day.completed { background: #d4edda; color: #155724; }
        .calendar-day.missed { background: #f8d7da; color: #721c24; }
        .calendar-day.future { color: #ccc; cursor: not-allowed; }
        .calendar-day.header { background: #f8f9fa; font-weight: bold; cursor: default; }
        .calendar-day.header:hover { background: #f8f9fa; }
        .quick-actions { display: flex; gap: 10px; margin: 15px 0; }
        .action-btn { padding: 8px 15px; border: 1px solid #ccc; background: white; border-radius: 4px; cursor: pointer; }
        .action-btn.mark-done { background: #28a745; color: white; border-color: #28a745; }
        .action-btn.mark-missed { background: #dc3545; color: white; border-color: #dc3545; }
        .action-btn:hover { opacity: 0.8; }
        .habit-actions { display: flex; gap: 10px; }
        .delete-btn { background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        .delete-btn:hover { background: #c82333; }
        .presets { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 15px 0; }
        .preset-btn { padding: 8px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; text-align: center; }
        .preset-btn:hover { background: #138496; }
        .export-controls { text-align: center; margin: 20px 0; }
        .export-btn { background: #6f42c1; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 0 5px; }
        .export-btn:hover { background: #5a32a3; }
    </style>
</head>
<body>
    <div class="tracker-container">
        <h2>📅 Habit Tracker - Visual Calendar & Streak Counter</h2>
        <p>Build lasting habits with visual progress tracking, streak counters, and calendar views. Perfect for personal development and goal achievement.</p>
        
        <div class="controls">
            <div class="control-section">
                <h3>➕ Add New Habit</h3>
                
                <div class="presets">
                    <button class="preset-btn" onclick="addPresetHabit('💧', 'Drink 8 glasses of water')">💧 Hydration</button>
                    <button class="preset-btn" onclick="addPresetHabit('🏃', 'Exercise for 30 minutes')">🏃 Exercise</button>
                    <button class="preset-btn" onclick="addPresetHabit('📚', 'Read for 20 minutes')">📚 Reading</button>
                    <button class="preset-btn" onclick="addPresetHabit('🧘', 'Meditate for 10 minutes')">🧘 Meditation</button>
                    <button class="preset-btn" onclick="addPresetHabit('🌅', 'Wake up at 6 AM')">🌅 Early Wake</button>
                    <button class="preset-btn" onclick="addPresetHabit('📱', 'No social media after 8 PM')">📱 Digital Detox</button>
                </div>
                
                <div class="habit-input">
                    <input type="text" id="habitEmoji" placeholder="🎯" maxlength="2" style="width: 50px; text-align: center;">
                    <input type="text" id="habitName" placeholder="Habit name (e.g., Exercise daily)">
                    <select id="habitFrequency">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="custom">Custom</option>
                    </select>
                    <button onclick="addHabit()">Add Habit</button>
                </div>
            </div>
            
            <div class="control-section">
                <h3>📊 Overview</h3>
                <div class="habit-stats" id="overviewStats">
                    <div class="stat-box">
                        <div class="stat-value" id="totalHabits">0</div>
                        <div class="stat-label">Total Habits</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="activeStreaks">0</div>
                        <div class="stat-label">Active Streaks</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="todayComplete">0</div>
                        <div class="stat-label">Today Complete</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="weeklyRate">0%</div>
                        <div class="stat-label">This Week</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="habits-list" id="habitsList">
            <!-- Habits will be dynamically added here -->
        </div>

        <div class="export-controls">
            <button class="export-btn" onclick="exportProgress()">📊 Export Progress</button>
            <button class="export-btn" onclick="shareProgress()">🔗 Share Progress</button>
            <button class="export-btn" onclick="importHabits()">📁 Import Habits</button>
            <button class="export-btn" onclick="clearAllData()" style="background: #dc3545;">🗑️ Clear All</button>
        </div>
    </div>

    <script>
        let habits = [];
        let currentDate = new Date();

        class Habit {
            constructor(emoji, name, frequency = 'daily') {
                this.id = Date.now() + Math.random();
                this.emoji = emoji;
                this.name = name;
                this.frequency = frequency;
                this.createdDate = new Date().toISOString().split('T')[0];
                this.completions = []; // Array of completed dates
                this.streak = 0;
                this.longestStreak = 0;
                this.isExpanded = false;
            }

            markComplete(date) {
                const dateStr = date.toISOString().split('T')[0];
                if (!this.completions.includes(dateStr)) {
                    this.completions.push(dateStr);
                    this.updateStreak();
                }
            }

            markIncomplete(date) {
                const dateStr = date.toISOString().split('T')[0];
                this.completions = this.completions.filter(d => d !== dateStr);
                this.updateStreak();
            }

            isCompleted(date) {
                const dateStr = date.toISOString().split('T')[0];
                return this.completions.includes(dateStr);
            }

            updateStreak() {
                let streak = 0;
                const today = new Date();
                const currentDate = new Date(today);
                
                // Count backwards from today
                while (currentDate >= new Date(this.createdDate)) {
                    const dateStr = currentDate.toISOString().split('T')[0];
                    if (this.completions.includes(dateStr)) {
                        streak++;
                    } else {
                        break;
                    }
                    currentDate.setDate(currentDate.getDate() - 1);
                }
                
                this.streak = streak;
                this.longestStreak = Math.max(this.longestStreak, streak);
            }

            getCompletionRate(days = 7) {
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(endDate.getDate() - days + 1);
                
                let completed = 0;
                let total = 0;
                
                const currentDate = new Date(startDate);
                while (currentDate <= endDate && currentDate >= new Date(this.createdDate)) {
                    total++;
                    if (this.isCompleted(currentDate)) {
                        completed++;
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                return total > 0 ? Math.round((completed / total) * 100) : 0;
            }
        }

        function addHabit() {
            const emoji = document.getElementById('habitEmoji').value || '🎯';
            const name = document.getElementById('habitName').value.trim();
            const frequency = document.getElementById('habitFrequency').value;
            
            if (!name) {
                alert('Please enter a habit name');
                return;
            }
            
            const habit = new Habit(emoji, name, frequency);
            habits.push(habit);
            
            // Clear form
            document.getElementById('habitEmoji').value = '';
            document.getElementById('habitName').value = '';
            document.getElementById('habitFrequency').value = 'daily';
            
            updateDisplay();
        }

        function addPresetHabit(emoji, name) {
            if (habits.find(h => h.name === name)) {
                alert('Habit already exists');
                return;
            }
            
            const habit = new Habit(emoji, name, 'daily');
            habits.push(habit);
            updateDisplay();
        }

        function removeHabit(habitId) {
            const habit = habits.find(h => h.id === habitId);
            if (confirm(`Delete habit "${habit.name}"? This will remove all progress data.`)) {
                habits = habits.filter(h => h.id !== habitId);
                updateDisplay();
            }
        }

        function toggleHabit(habitId) {
            const habit = habits.find(h => h.id === habitId);
            if (habit) {
                habit.isExpanded = !habit.isExpanded;
                updateDisplay();
            }
        }

        function markHabitDay(habitId, date, completed) {
            const habit = habits.find(h => h.id === habitId);
            if (habit) {
                if (completed) {
                    habit.markComplete(date);
                } else {
                    habit.markIncomplete(date);
                }
                updateDisplay();
            }
        }

        function updateDisplay() {
            updateOverviewStats();
            updateHabitsList();
        }

        function updateOverviewStats() {
            const totalHabits = habits.length;
            const activeStreaks = habits.filter(h => h.streak > 0).length;
            const today = new Date();
            const todayComplete = habits.filter(h => h.isCompleted(today)).length;
            const weeklyRate = habits.length > 0 ? 
                Math.round(habits.reduce((sum, h) => sum + h.getCompletionRate(7), 0) / habits.length) : 0;
            
            document.getElementById('totalHabits').textContent = totalHabits;
            document.getElementById('activeStreaks').textContent = activeStreaks;
            document.getElementById('todayComplete').textContent = `${todayComplete}/${totalHabits}`;
            document.getElementById('weeklyRate').textContent = weeklyRate + '%';
        }

        function updateHabitsList() {
            const container = document.getElementById('habitsList');
            
            if (habits.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; margin: 40px 0;">No habits yet. Add your first habit above!</p>';
                return;
            }
            
            container.innerHTML = '';
            
            habits.forEach(habit => {
                const habitCard = document.createElement('div');
                habitCard.className = 'habit-card';
                
                const today = new Date();
                const isCompletedToday = habit.isCompleted(today);
                
                habitCard.innerHTML = `
                    <div class="habit-header" onclick="toggleHabit(${habit.id})">
                        <div class="habit-title">
                            <span style="font-size: 1.2em;">${habit.emoji}</span>
                            <span>${habit.name}</span>
                            ${isCompletedToday ? '<span style="color: #28a745;">✓</span>' : ''}
                        </div>
                        <div class="habit-streak ${habit.streak === 0 ? 'broken' : ''}">
                            ${habit.streak} day streak
                        </div>
                    </div>
                    <div class="habit-content ${habit.isExpanded ? 'expanded' : ''}" id="content_${habit.id}">
                        <div class="habit-stats">
                            <div class="stat-box">
                                <div class="stat-value">${habit.streak}</div>
                                <div class="stat-label">Current Streak</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value">${habit.longestStreak}</div>
                                <div class="stat-label">Best Streak</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value">${habit.completions.length}</div>
                                <div class="stat-label">Total Days</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value">${habit.getCompletionRate(7)}%</div>
                                <div class="stat-label">This Week</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value">${habit.getCompletionRate(30)}%</div>
                                <div class="stat-label">This Month</div>
                            </div>
                        </div>
                        
                        <div class="quick-actions">
                            <button class="action-btn ${isCompletedToday ? '' : 'mark-done'}" 
                                    onclick="markHabitDay(${habit.id}, new Date(), ${!isCompletedToday})">
                                ${isCompletedToday ? '✓ Completed Today' : '✓ Mark Done Today'}
                            </button>
                            ${isCompletedToday ? `<button class="action-btn mark-missed" 
                                onclick="markHabitDay(${habit.id}, new Date(), false)">✗ Mark Undone</button>` : ''}
                        </div>
                        
                        <div class="calendar-view">
                            <div class="calendar-header">
                                <button class="calendar-nav" onclick="changeMonth(${habit.id}, -1)">‹</button>
                                <h4 id="monthYear_${habit.id}">${getMonthYearString(currentDate)}</h4>
                                <button class="calendar-nav" onclick="changeMonth(${habit.id}, 1)">›</button>
                            </div>
                            <div class="calendar-grid" id="calendar_${habit.id}">
                                ${generateCalendar(habit, currentDate)}
                            </div>
                        </div>
                        
                        <div class="habit-actions">
                            <button class="delete-btn" onclick="removeHabit(${habit.id})">Delete Habit</button>
                        </div>
                    </div>
                `;
                
                container.appendChild(habitCard);
            });
        }

        function generateCalendar(habit, date) {
            const year = date.getFullYear();
            const month = date.getMonth();
            const today = new Date();
            
            // Days of week headers
            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            let calendar = daysOfWeek.map(day => 
                `<div class="calendar-day header">${day}</div>`
            ).join('');
            
            // First day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                calendar += '<div class="calendar-day"></div>';
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const currentDay = new Date(year, month, day);
                const dayStr = currentDay.toISOString().split('T')[0];
                const isToday = currentDay.toDateString() === today.toDateString();
                const isCompleted = habit.isCompleted(currentDay);
                const isFuture = currentDay > today;
                const isBeforeHabit = currentDay < new Date(habit.createdDate);
                
                let cssClass = 'calendar-day';
                if (isToday) cssClass += ' today';
                if (isCompleted) cssClass += ' completed';
                if (isFuture || isBeforeHabit) cssClass += ' future';
                if (!isCompleted && !isFuture && !isBeforeHabit && currentDay < today) cssClass += ' missed';
                
                const clickHandler = (isFuture || isBeforeHabit) ? '' : 
                    `onclick="markHabitDay(${habit.id}, new Date('${dayStr}'), ${!isCompleted})"`;
                
                calendar += `<div class="${cssClass}" ${clickHandler}>${day}</div>`;
            }
            
            return calendar;
        }

        function changeMonth(habitId, direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            updateDisplay();
        }

        function getMonthYearString(date) {
            return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
        }

        function exportProgress() {
            let report = 'Habit Tracker Progress Report\n';
            report += '==================================\n\n';
            report += `Generated: ${new Date().toLocaleDateString()}\n\n`;
            
            habits.forEach(habit => {
                report += `${habit.emoji} ${habit.name}\n`;
                report += `Current Streak: ${habit.streak} days\n`;
                report += `Best Streak: ${habit.longestStreak} days\n`;
                report += `Total Completions: ${habit.completions.length} days\n`;
                report += `This Week: ${habit.getCompletionRate(7)}%\n`;
                report += `This Month: ${habit.getCompletionRate(30)}%\n`;
                report += `Created: ${new Date(habit.createdDate).toLocaleDateString()}\n\n`;
            });
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `habit_progress_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function shareProgress() {
            const totalStreaks = habits.reduce((sum, h) => sum + h.streak, 0);
            const avgCompletion = habits.length > 0 ? 
                Math.round(habits.reduce((sum, h) => sum + h.getCompletionRate(7), 0) / habits.length) : 0;
            
            const shareText = `🎯 My Habit Progress:\n📊 ${habits.length} habits tracked\n🔥 ${totalStreaks} total streak days\n📈 ${avgCompletion}% completion this week\n\nBuilding better habits daily! 💪`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'My Habit Progress',
                    text: shareText,
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Progress copied to clipboard!');
                });
            }
        }

        function importHabits() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedHabits = JSON.parse(e.target.result);
                            if (confirm(`Import ${importedHabits.length} habits? This will add to existing habits.`)) {
                                importedHabits.forEach(habitData => {
                                    const habit = new Habit(habitData.emoji, habitData.name, habitData.frequency);
                                    habit.completions = habitData.completions || [];
                                    habit.createdDate = habitData.createdDate || habit.createdDate;
                                    habit.updateStreak();
                                    habits.push(habit);
                                });
                                updateDisplay();
                                alert('Habits imported successfully!');
                            }
                        } catch (error) {
                            alert('Error importing habits: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function clearAllData() {
            if (confirm('Clear all habits and progress data? This cannot be undone.')) {
                habits = [];
                updateDisplay();
            }
        }

        // Initialize with sample habits
        habits = [
            (() => {
                const habit = new Habit('💧', 'Drink 8 glasses of water', 'daily');
                habit.createdDate = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                // Add some sample completions
                for (let i = 5; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    if (Math.random() > 0.3) { // 70% completion rate
                        habit.markComplete(date);
                    }
                }
                return habit;
            })(),
            (() => {
                const habit = new Habit('🏃', 'Exercise for 30 minutes', 'daily');
                habit.createdDate = new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                // Add some sample completions
                for (let i = 8; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    if (Math.random() > 0.4) { // 60% completion rate
                        habit.markComplete(date);
                    }
                }
                return habit;
            })()
        ];

        updateDisplay();
    </script>
</body>
</html>
